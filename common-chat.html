<head>
	<head>
	<title>HoloChatStats: Common Chat Heatmap</title>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="css/bootstrap-social.css">
	<script src="https://d3js.org/d3.v4.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
	<script src="https://d3js.org/d3-color.v1.min.js"></script>
	<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9XPX4HFYKX"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-9XPX4HFYKX');
	</script>
	<script>
function updateChart() {
	$("#hmdiv").remove();
	$(".graphs").append('<div id="hmdiv"></div>');

  var margin = { top: 40, right: 25, bottom: 30, left: 50 },
    width = 1850 - margin.left - margin.right,
    height = 900 - margin.top - margin.bottom;

  var svg = d3
    .select("#hmdiv")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	
  var path = "";
  if ($("#branch").val() == "all") {
	  if ($("#minComments").val() != "1") {
		path = "csv/common/" + $("#chartType").val() + "_" + $("#minComments").val() + ".csv";
	  }
	  else {
		path = "csv/common/" + $("#chartType").val() + ".csv";
	  }
  }
  else {
	  if ($("#minComments").val() != "1") {
		path = "csv/common/" + $("#chartType").val() + "_" + $("#branch").val() + "_" + $("#minComments").val() + ".csv";
	  }
	  else {
		path = "csv/common/" + $("#chartType").val() + "_" + $("#branch").val() + ".csv";
	  }
  }

  d3.csv(
    path,
    function (data) {
      var myGroups = d3
        .map(data, function (d) {
          return d.from;
        })
        .keys();
      var myVars = d3
        .map(data, function (d) {
          return d.to;
        })
        .keys();

      var x = d3.scaleBand().range([0, width]).domain(myGroups).padding(0.05);
      svg
        .append("g")
        .style("font-size", 10)
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).tickSize(0))
        .select(".domain")
        .remove();

      var y = d3.scaleBand().range([height, 0]).domain(myVars).padding(0.05);
      svg
        .append("g")
        .style("font-size", 10)
		.style("fill", "#DADADA")
        .call(d3.axisLeft(y).tickSize(0))
        .select(".domain")
        .remove();

      var colorScale = ["#23171b","#271a28","#2b1c33","#2f1e3f","#32204a","#362354","#39255f","#3b2768","#3e2a72","#402c7b","#422f83","#44318b","#453493","#46369b","#4839a2","#493ca8","#493eaf","#4a41b5","#4a44bb","#4b46c0","#4b49c5","#4b4cca","#4b4ecf","#4b51d3","#4a54d7","#4a56db","#4959de","#495ce2","#485fe5","#4761e7","#4664ea","#4567ec","#446aee","#446df0","#426ff2","#4172f3","#4075f5","#3f78f6","#3e7af7","#3d7df7","#3c80f8","#3a83f9","#3985f9","#3888f9","#378bf9","#368df9","#3590f8","#3393f8","#3295f7","#3198f7","#309bf6","#2f9df5","#2ea0f4","#2da2f3","#2ca5f1","#2ba7f0","#2aaaef","#2aaced","#29afec","#28b1ea","#28b4e8","#27b6e6","#27b8e5","#26bbe3","#26bde1","#26bfdf","#25c1dc","#25c3da","#25c6d8","#25c8d6","#25cad3","#25ccd1","#25cecf","#26d0cc","#26d2ca","#26d4c8","#27d6c5","#27d8c3","#28d9c0","#29dbbe","#29ddbb","#2adfb8","#2be0b6","#2ce2b3","#2de3b1","#2ee5ae","#30e6ac","#31e8a9","#32e9a6","#34eba4","#35eca1","#37ed9f","#39ef9c","#3af09a","#3cf197","#3ef295","#40f392","#42f490","#44f58d","#46f68b","#48f788","#4af786","#4df884","#4ff981","#51fa7f","#54fa7d","#56fb7a","#59fb78","#5cfc76","#5efc74","#61fd71","#64fd6f","#66fd6d","#69fd6b","#6cfd69","#6ffe67","#72fe65","#75fe63","#78fe61","#7bfe5f","#7efd5d","#81fd5c","#84fd5a","#87fd58","#8afc56","#8dfc55","#90fb53","#93fb51","#96fa50","#99fa4e","#9cf94d","#9ff84b","#a2f84a","#a6f748","#a9f647","#acf546","#aff444","#b2f343","#b5f242","#b8f141","#bbf03f","#beef3e","#c1ed3d","#c3ec3c","#c6eb3b","#c9e93a","#cce839","#cfe738","#d1e537","#d4e336","#d7e235","#d9e034","#dcdf33","#dedd32","#e0db32","#e3d931","#e5d730","#e7d52f","#e9d42f","#ecd22e","#eed02d","#f0ce2c","#f1cb2c","#f3c92b","#f5c72b","#f7c52a","#f8c329","#fac029","#fbbe28","#fdbc28","#feb927","#ffb727","#ffb526","#ffb226","#ffb025","#ffad25","#ffab24","#ffa824","#ffa623","#ffa323","#ffa022","#ff9e22","#ff9b21","#ff9921","#ff9621","#ff9320","#ff9020","#ff8e1f","#ff8b1f","#ff881e","#ff851e","#ff831d","#ff801d","#ff7d1d","#ff7a1c","#ff781c","#ff751b","#ff721b","#ff6f1a","#fd6c1a","#fc6a19","#fa6719","#f96418","#f76118","#f65f18","#f45c17","#f25916","#f05716","#ee5415","#ec5115","#ea4f14","#e84c14","#e64913","#e44713","#e24412","#df4212","#dd3f11","#da3d10","#d83a10","#d5380f","#d3360f","#d0330e","#ce310d","#cb2f0d","#c92d0c","#c62a0b","#c3280b","#c1260a","#be2409","#bb2309","#b92108","#b61f07","#b41d07","#b11b06","#af1a05","#ac1805","#aa1704","#a81604","#a51403","#a31302","#a11202","#9f1101","#9d1000","#9b0f00","#9a0e00","#980e00","#960d00","#950c00","#940c00","#930c00","#920c00","#910b00","#910c00","#900c00","#900c00","#900c00"];
	  
	 var colors = d3.scaleQuantize()
    .domain([0,60])
    .range(colorScale);

      // create a tooltip
      var tooltip = d3
        .select("#hmdiv")
        .append("div")
        .style("opacity", 0)
        .attr("class", "tooltip")
        .style("background-color", "white")
        .style("border", "solid")
        .style("border-width", "2px")
        .style("border-radius", "5px")
        .style("padding", "5px");

      var mouseover = function (d) {
        tooltip.style("opacity", 1);
        d3.select(this).style("stroke", "green").style("opacity", 1);
      };
      var mousemove = function (d) {
        tooltip
          .html("Percent of " + d.from  + "'s chat users in " + d.to + "'s chat: " + d.value)
          .style("left", d3.mouse(this)[0] + 70 + "px")
          .style("top", d3.mouse(this)[1] + 75 + "px");
      };
      var mouseleave = function (d) {
        tooltip.style("opacity", 0);
        d3.select(this).style("stroke", "none").style("opacity", 0.8);
      };

      svg
        .selectAll()
        .data(data, function (d) {
          return d.from + ":" + d.to;
        })
        .enter()
        .append("rect")
        .attr("x", function (d) {
          return x(d.from);
        })
        .attr("y", function (d) {
          return y(d.to);
        })
        .attr("rx", 4)
        .attr("ry", 4)
        .attr("width", x.bandwidth())
        .attr("height", y.bandwidth())
        .style("fill", d=>colors(d.value))
        .style("stroke-width", 4)
        .style("stroke", "none")
        .style("opacity", 0.8)
        .on("mouseover", mouseover)
        .on("mousemove", mousemove)
        .on("mouseleave", mouseleave);
    }
  );

  svg
    .append("text")
    .attr("x", 0)
    .attr("y", -20)
    .attr("text-anchor", "left")
    .style("font-size", "18px")
	.style("fill", "#DADADA")
    .text("Common Chat Users: " + $("#chartType option:selected").text());
}
window.onload = function() {
	$("#chartType").on('change', updateChart)
	$("#minComments").on('change', updateChart)
	$("#branch").on('change', updateChart)
	updateChart();
};
</script>
<style>
	body {
		padding-top: 65px;
	}
	.graphs {
		display: grid;
		grid-auto-flow: row;
		grid-template-columns: 45vw 45vw;
		grid-template-rows: auto;
	}
	text {
		fill: #DADADA;
	}
</style>
</head>
<body style="background-color:#221F1E;">
	<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
		<a class="navbar-brand" href="/">HoloChatStats</a>
		<div class="collapse navbar-collapse" id="navbarCollapse">
		<ul class="navbar-nav mr-auto">
			<div class="dropdown">
				<button class="btn btn-secondary dropdown-toggle" type="button" id="categoryButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Language
				</button>
				<div class="dropdown-menu scrollable-menu" aria-labelledby="dropdownMenuButton" id="categoryDropdown">
				<div id="categoryList">
						<a class="dropdown-item" id="non-jp-holojp" href="nonjp-holojp">Non-JP %/Rates (HoloJP)</a>
						<a class="dropdown-item" id="non-jp-holostars" href="nonjp-holostars">Non-JP %/Rates (HoloStars)</a>
						<a class="dropdown-item" id="jp-stats" href="jp-holoiden">JP %/Rates (HoloID/HoloEN)</a>
						<a class="dropdown-item" id="lang-summary" href="langsum">Language Summary Stats</a>
				</div>
				</div>
			</div>
			<div class="dropdown">
				<button class="btn btn-secondary dropdown-toggle" type="button" id="categoryButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Translations
				</button>
				<div class="dropdown-menu scrollable-menu" aria-labelledby="dropdownMenuButton" id="categoryDropdown">
				<div id="categoryList">
						<a class="dropdown-item" id="en-live-tl" href="en-livetl">English Live Translations</a>
						<a class="dropdown-item" id="en-live-tl" href="en-tl-stream">English Top Live Translated Streams</a>
				</div>
				</div>
			</div>
			<div class="dropdown">
				<button class="btn btn-secondary dropdown-toggle" type="button" id="categoryButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Users
				</button>
				<div class="dropdown-menu scrollable-menu" aria-labelledby="dropdownMenuButton" id="categoryDropdown">
				<div id="categoryList">
						<a class="dropdown-item" id="common-chat" href="common-chat">Common User Heatmap</a>
						<a class="dropdown-item" id="excl-chat" href="excl-chat">Exclusive Chat Users</a>
				</div>
				</div>
			</div>
			<div class="dropdown">
				<button class="btn btn-secondary dropdown-toggle" type="button" id="categoryButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Other
				</button>
				<div class="dropdown-menu scrollable-menu" aria-labelledby="dropdownMenuButton" id="categoryDropdown">
				<div id="categoryList">
						<a class="dropdown-item" id="stream-time" href="stream-time">Stream Time Stats</a>
						<a class="dropdown-item" id="stream-time-series" href="stream-time-series">Stream Time Monthly Trend</a>
						<a class="dropdown-item" id="chat-makeup" href="chat-makeup">Avg. Chat Makeup</a>
				</div>
				</div>
			</div>
		</ul>
				<ul class="navbar-nav ml-auto">
			<div class="dropdown">
				<button class="btn btn-secondary dropdown-toggle" type="button" id="sitesButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Other Sites
				</button>
				<div class="dropdown-menu scrollable-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton" id="categoryDropdown">
				<div id="siteList">
						<h6 class="dropdown-header">Machine Generated Clips</h6>
						<a class="dropdown-item" href="https://clip.holochatstats.info">HoloAutoClip</a>
						<a class="dropdown-item" href="https://clip.holochatstats.info/vt">VTAutoClip</a>
				</div>
		</div>
		<a class="btn btn-social-icon btn-twitter" href="https://www.twitter.com/HoloChatStat" target="_blank">
				<i class="fa fa-twitter">
				</i>
		</a>
		</ul>
		</div>
	</nav>
		<label style="color: #DEDEDE">Month: </label>
		<select id="chartType">
			<option value="hl-2022-04">April 2022</option>
			<option value="hl-2022-03">March 2022</option>
			<option value="hl-2022-02">February 2022</option>
			<option value="hl-2022-01">January 2022</option>
			<option value="hl-2021-12">December 2021</option>
			<option value="hl-2021-11">November 2021</option>
			<option value="hl-2021-10">October 2021</option>
			<option value="hl-2021-09">September 2021</option>
			<option value="hl-2021-08">August 2021</option>
			<option value="hl-2021-07">July 2021</option>
			<option value="hl-2021-06">June 2021</option>
		    <option value="hl-2021-05">May 2021</option>
			<option value="hl-2021-04">April 2021</option>
			<option value="hl-2021-03">March 2021</option>
			<option value="hl-2021-02">February 2021</option>
			<option value="hl-2021-01">January 2021</option>
			<option value="hl-2020-12">December 2020</option>
			<option value="hl-2020-11">November 2020</option>
			<option value="hl-2020-10">October 2020</option>
			<option value="hl-2020-09">September 2020</option>
			<option value="hl-2020-08">August 2020</option>
			<option value="hl-2020-07">July 2020</option>
			<option value="hl-2020-06">June 2020</option>
		</select>
		<label style="color: #DEDEDE">Branch: </label>
		<select id="branch">
			<option value="en">EN</option>
			<option value="jp">JP</option>
			<option value="id">ID</option>
			<option value="hs">Holostars</option>
			<option value="all">All (2/2022 and earlier)</option>
		</select>
		<label style="color: #DEDEDE">Min. Comments per Member: </label>
		<select id="minComments">
			<option value="1">1</option>
			<option value="3">3</option>
			<option value="10">10</option>
		</select>
	<div style="color: #DEDEDE">Note: This data is based on simple name matching and does not account for duplicate names and alt accounts. Collabs and differences in the amount of unique chat users affect this data. Min. comments option available from September 2021 onwards.</div>
	<div class="graphs">
		<div id="hmdiv">
		</div>
	</div>
</body>